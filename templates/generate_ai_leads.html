{% extends "base.html" %}

{% block title %}AI Lead Generation{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="text-center mb-4">AI-Powered Lead Generation</h1>

    <div class="card shadow-sm mb-4 mx-auto" style="max-width: 600px;">
        <div class="card-body">
            <h2 class="card-title text-center mb-4">Generate Leads with AI</h2>
            <form method="POST" action="{{ url_for('generate_ai_leads') }}">
                {{ form.csrf_token }}

                <div class="mb-3">
                    <label for="{{ form.prompt.id }}" class="form-label">Lead Generation Prompt</label>
                    {{ form.prompt(class="form-control", rows="5", placeholder="e.g., 'influencers in tech in Silicon Valley with over 10k followers'") }}
                    {% if form.prompt.errors %}
                        <ul class="text-danger mt-1">
                            {% for error in form.prompt.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>

                <div class="text-center">
                    {{ form.submit(class="btn btn-primary") }}
                </div>
            </form>
        </div>
    </div>

    {% if generated_leads %}
    <div class="card shadow-sm p-3">
        <h2 class="card-title mb-4">Generated Leads</h2>
        {% if generated_leads|length > 0 %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col">Username</th>
                        <th scope="col">Full Name</th>
                        <th scope="col">Platform</th>
                        <th scope="col">Email</th>
                        <th scope="col">Website</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lead in generated_leads %}
                    <tr>
                        <td>{{ lead.username }}</td>
                        <td>{{ lead.full_name or 'N/A' }}</td>
                        <td>{{ lead.platform or 'N/A' }}</td>
                        <td>{{ lead.email or 'N/A' }}</td>
                        <td>
                            {% if lead.website %}
                                <a href="{{ lead.website }}" target="_blank">{{ lead.website }}</a>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            <form action="{{ url_for('add_lead_from_ai') }}" method="POST" class="d-inline">
                                <input type="hidden" name="username" value="{{ lead.username }}">
                                <input type="hidden" name="platform" value="{{ lead.platform }}">
                                <input type="hidden" name="full_name" value="{{ lead.full_name }}">
                                <input type="hidden" name="bio" value="{{ lead.bio }}">
                                <input type="hidden" name="followers" value="{{ lead.followers }}">
                                <input type="hidden" name="email" value="{{ lead.email }}">
                                <input type="hidden" name="website" value="{{ lead.website }}">
                                <input type="hidden" name="location" value="{{ lead.location }}">
                                <input type="hidden" name="profile_url" value="{{ lead.profile_url }}">
                                <input type="hidden" name="engagement_score" value="{{ lead.engagement_score }}">
                                <input type="hidden" name="tags" value="{{ lead.tags }}">
                                <input type="hidden" name="company_name" value="{{ lead.company_name }}">
                                <input type="hidden" name="company_industry" value="{{ lead.company_industry }}">
                                <input type="hidden" name="company_size" value="{{ lead.company_size }}">
                                <input type="hidden" name="job_title" value="{{ lead.job_title }}">
                                <input type="hidden" name="tech_stack" value="{{ lead.tech_stack }}">
                                <button type="submit" class="btn btn-success btn-sm">Add to Leads</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">No leads generated yet. Try a different prompt!</p>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}